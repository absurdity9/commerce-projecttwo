{% extends "auctions/layout.html" %}

{% block body %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@latest/css/bulma.min.css">

{% if listing %}
  <div class="is-four-fifths">
  <h1 class="title is-1">{{ listing.item.title }}</h1>
    
    <div class="box">
      <p>{{ listing.item.desc }}</p>
      <p>Starting at: {{ listing.item.floor_price }}</p>
      <p>Ends at: {{ listing.date_end }}</p>
    </div>
      <div class="block"></div>
    {% if user.is_authenticated %}
    <div class="actions-container">
      <!-- Close listing -->
      {% if user.username|stringformat:"s" == listing.item.owner_id|stringformat:"s" %}
        <form method="post" action="{% url 'close_listing' item_id=listing.item.id %}">
          {% csrf_token %}
          <input type="hidden" name="item_id" value="{{ listing.item.id }}">
          <button class="button is-primary" type="submit">Close Listing</button>
        </form>
      {% else %}
      <div class="box">
        <p>Item owned by {{ listing.item.owner_id|default_if_none:"None"|default:"Unknown" }}</p>      </div>
        {% endif %}
        <div class="block"></div>
    {% endif %}
    <article class="message is-info">
      <div class="message-body">
        <p>Highest Bid: {{ listing.highestbid }}
        </div>
    </article>
  </div>

  <div class="is-four-fifths">
    <img src="{{ listing.item.photo_url }}" alt="Listing Photo" width="500" height="500">
  </div>

  {% else %}
    <p>This item does not exist</p>
  {% endif %}

  {% if user.is_authenticated %}
  {% if listing.item.id in watchlist_items %}
  <!-- Watchlisted, show remove -->
  <a href="{% url 'remove_watchlist' item_id=listing.item.id %}"><button class="button is-primary">Remove from my watchlist</button></a>        
  {% else %}
  <hr class="solid">
  <!-- Not watchlisted, show add -->
  <a href="{% url 'add_watchlist' item_id=listing.item.id %}"><button class="button is-primary">Save to {{ user.username }}'s watchlist</button></a>
  {% endif %}
  <hr class="solid">
<!-- Make a bid -->
<div class="card">
  <div class="card-content">
    <p class="title">
      Place your bid
    </p>
    <p class="subtitle">
      <form action="" method="POST">
        <div class="field">
          <label class="label">Amount</label>
        </div>
        <input class="input is-primary" name="bid_amount" type="text" width="280px" placeholder="Â£1 minimum">
        <div class="block"></div>
        <div class="field">
          <p class="control">          
            <button class="button is-primary" type="submit">Make a bid</button>
          </p>
          </div>
      </form>
    </p>
  </div>
</div>
<div class="block"></div>
<div class="card">
  <div class="card-content">
    <p class="title">
    Comments
    </p>
    <p class="subtitle">
      <form action="" method="POST">
        {% csrf_token %}
        {{ create_comments_form.as_p }}
        <button class="button is-primary" type="submit">Add comment</button>
    </form>
      {% for comment in comments %}
    <div class="is-two-fifths">
        <p>{{ comment.detail }}</p>
        <p>Posted on: {{ comment.date_created }} by {{comment.userid }}</p>
    </div>
    {% endfor %}
    </div>
    {% else %}
      Sign in to see comments and bids
    {% endif %}
    </p>
  </div>

{% endblock %}